@using ShowNest.Web.ViewModels.Events
@using System.Reflection
@* @model OrderDto *@
@model System.Collections.Generic.Dictionary<string, string>



@section topCSS {
    <link href="~/css/_Partial/_PurchaseStepsPartial.css" rel="stylesheet" />
    <link href="~/css/events/paymentinfo.css" rel="stylesheet" />
}
@section Scripts
{
    <script src="~/js/Events/PaymentInfo.js" asp-append-version="true"></script>
}

    <div class="count_down_group">
        <div id="counterOnPayment" class="count_down_timer main_wrap width d-flex">
            您的訂單已保留，請在 {{ counter }} 內完成填寫資料並確認訂單。若超過時限，系統將自動取消。
        </div>
</div>
<section id="paymentInfo" class="section_wrap">
 <div class="main_event_order">
    <div class="title main_wrap width">
            <h2>{{data.eventDetail && data.eventDetail.eventName}}</h2>
        </div>
    <div class="event_details main_wrap width">
            <div class="collapse_group">
                <p class="d-inline-flex gap-1">
                    <button class="event_detail_collapse btn" type="button" data-bs-toggle="collapse"
                            data-bs-target="#collapse-example" aria-expanded="false" aria-controls="collapse-example" stlye="box-shadow: none; background-color:none;">
                        顯示活動詳細資料
                    </button>
                </p>
                <div class="collapse" id="collapse-example">
                    <table class="details">
                        <tbody>
                            <tr class="">
                                <th class="start_time">開始時間</th>
                                <td class="time">
                                    {{data.eventDetail && data.eventDetail.startTime}}
                                    <a class="is_following binding" href="#" target="_blank" >
                                        <i class="fa fa-calendar fa-front"></i>
                                        加入行事曆
                                    </a>
                                </td>
                            </tr>
                            <!-- location -->
                            <tr class="">
                                <th class="event_location">活動地點</th>
                                <td class="location">
                                    {{data.eventDetail && data.eventDetail.eventLocation}}
                                    <a class="is_following binding " target="_blank" href="#">
                                        <i class="fa fa-map-marker fa-front"></i>
                                        檢視地圖
                                    </a>
                                </td>
                            </tr>
                            <!-- event.co_organizer -->
                            <tr>
                                <th class="co_organizer">主辦單位</th>
                                <td class="co_organizer_name">{{ data.eventDetail && data.eventDetail.eventHost }}</td>
                            </tr>
                            <!--  pickup_types -->
                            <tr class="pickup_types_group">
                                <th class="pickup_types">票券種類</th>
                                <td class="type_names">台灣全家 FamiPort 取票</td>
                            </tr>
                            <!--payment_terms -->
                            <tr class="payment_terms_group">
                                <th class="payment_terms">付款方式</th>
                                <td class="payment_names">
                                    信用卡
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="progress_container" v-if="data.hasSeats">
                @await Html.PartialAsync("_PurchaseStepsPartial", new List<StepStatusViewModel> {
                    new StepStatusViewModel { InProgress = false, IsDisabled = true },
                    new StepStatusViewModel { InProgress = false, IsDisabled = true },
                    new StepStatusViewModel { InProgress = false, IsDisabled = true },
                    new StepStatusViewModel { InProgress = true, IsDisabled = false }
                })
            </div>
            <div class="progress_container" v-if="!data.hasSeats">
                @await Html.PartialAsync("_PurchaseStepsPartialWithoutSeats", new List<StepStatusViewModel>
                {
                    new StepStatusViewModel {InProgress = false, IsDisabled = true},
                    new StepStatusViewModel {InProgress = false, IsDisabled = true},
                    new StepStatusViewModel {InProgress = true, IsDisabled = false}
                })
            </div>
            <form name="finalOrder" class="">
                <div class="final_order_list_title">
                    <h3 class="order_number">訂單編號 : {{orderId}}</h3>
                </div>

                <div class="final_order_list">
                    <table class="table">
                        <tbody id="ticket_info_list" class="ticket_info_list" v-for="ticket in data.tickets">
                            <tr>
                                <th class="ticket_type">票券</th>
                                <td colspan="2" class="ticket_wrapper_td">
                                    <table class="cart_ticket_list">
                                        <tbody>
                                            <tr>
                                                <td class="ticket_name">全票</td>
                                                <td class="ticket-data" colspan="2">
                                                    <table class="cart-ticket-list-subtable with-seat">
                                                        <tbody>
                                                            <tr class="seat_info_group">
                                                                <td class="seat_info">
                                                                    <ul>
                                                                        <li>
                                                                            <span class="seat">
                                            {{ticket.seatAreaName}} {{ticket.seatNumber}}
                                                                            </span>
                                                                        </li>
                                                                    </ul>
                                                                </td>
                                                                <td class="price_count">
                                                                    <span class="price">TWD${{ticket.price}}</span>
                                                                    x 1
                                                                </td>
                                                                <td class="price_total">
                                                                    TWD${{ticket.price}}
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </td>
                            </tr>
                        </tbody>
                        <tbody class="pickup-and-payment-block">
                            <tr id="payment-type-block">
                                <th class="required">
                                    付款方式
                                </th>
                                <td colspan="2">
                                    <div class="purchase_options">
                                        <div class="data-body">
                                            <div class="payments">
                                                <ul>
                                                    <li>
                                                        <div class="payments_radio">
                                                            <label class="radio payment-method-label">
                                                                <input type="radio" value="CREDITCARD"
                                                                       name="paymentMethodType" required="">
                                                                信用卡
                                                            </label>
                                                            <div class="form-wrapper order_cardtype">
                                                                <div class="control-group">
                                                                    <label class="control-label">
                                                                        信用卡卡號
                                                                    </label>
                                                                    
                                                                </div>

                                                                    </div>
                                                                </div>
                                                </ul>            
                                                        
                                                    
                                                
                                            </div>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr class="fee_group">
                                <th class="fee">取票手續費</th>
                                <td colspan="2">
                                    TWD$0
                                </td>
                            </tr>
                            <tr class="highlight">
                                <th class="total">總金額</th>
                                <td class="total-price" colspan="2">TWD${{totalPrice}}</td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
                <div>
                </div>
            </form>
     </div>
  </div>
   
    <form id="form" name="form" method="POST" action="https://payment-stage.ecpay.com.tw/Cashier/AioCheckOut/V5" style="display:none;" >
        @* @foreach (var item in Model) *@
        @* { *@
        @* <input type="text" name="@item.Key" value="@item.Value" /> *@
        @*     <br /> *@
        @* } *@
        @* <button type="submit" id="checkoutBtn">送出</button> *@
    </form>
        <div class="submit_group control-group">
        <div class="btn_submit width">
            <label for="checkoutBtn">
                <a  class="btn btn_submit" id="btn_submit" @@click="onCheckoutClicked"
                   style="background-color:var(--main-green);color: white;" disabled="">
                        <span>
                            <i class="fa fa-check-circle"></i>
                        </span>
                        <span class="confirm">
                            確認訂單並繳費
                        </span>
                        TWD${{totalPrice}}
                </a>
            </label>
        </div>
        </div>
</section>

<!-- js套件 -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery-twzipcode@1.7.14/jquery.twzipcode.min.js"></script>
<!-- 自己的 -->
@* <script> *@
@*     $("#checkoutBtn").on('click', (e) => { *@
@*         //因為送出就跳轉到綠界，這個可以停住確認自己的console.log的內容 *@
@*         let formData = $("#form").serializeArray(); *@
@*         const json = {}; *@
@*         $.each(formData, function () { *@
@*             json[this.name] = this.value || ""; *@
@*         }); *@
@*         console.log(json); *@
@*         //step3 : 新增訂單到資料庫 *@
@*         $.ajax({ *@
@*             type: 'POST', *@
@*             url: '/api/Ecpay/AddOrders', *@
@*             contentType: 'application/json; charset=utf-8', *@
@*             data: JSON.stringify(json), *@
@*             success: function (res) { *@
@*                 console.log(res); *@
@*             }, *@
@*             error: function (err) { console.log(err); }, *@
@*         }); *@
@*     }); *@
@* </script> *@


@*  <form id="form" name="form" method="POST" action="https://payment-stage.ecpay.com.tw/Cashier/AioCheckOut/V5" style="display:;">
        <!--step2 : 收到後端的值印出來-->
        @foreach (var property in @Model.GetType().GetProperties())
        {
            var value = property.GetValue(Model);
            @(property.Name) <input type="text" name="@property.Name" value="@value" />

            <br />
        }
        CheckMacValue<input type="text" name="CheckMacValue" value="@ViewData["CheckMacValue"] " />
        <button type="submit" id="checkoutBtn" for="">送出</button>
    </form> *@ 